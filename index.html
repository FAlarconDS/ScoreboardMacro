<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoreboard - Competencia Aniversario</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Fredoka+One&family=Press+Start+2P&family=Monoton&family=Shrikhand&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #DAE1E7;
            color: #1f2937;
            position: relative;
            overflow-x: hidden;
        }
        #winner-modal {
            transition: opacity 0.3s ease-in-out;
            z-index: 60;
        }
        #winner-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .score-change {
            transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform: scale(1.2);
        }
        .title-70s {
            font-family: 'Shrikhand', cursive;
            color: white;
            text-shadow: 2px 2px 0px #c2410c, 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .title-80s {
            font-family: 'Monoton', cursive;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .title-90s {
            font-family: 'Press Start 2P', cursive;
            color: white;
            text-shadow: 3px 3px 0px #1e40af;
        }
        .title-00s {
            font-family: 'Fredoka One', cursive;
            color: white;
            text-shadow: 2px 2px 0px #5b21b6;
        }
        @keyframes leader-pulse {
            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(253, 224, 71, 0.6);
            }
            50% {
                transform: scale(1.03);
                box-shadow: 0 0 35px 5px rgba(253, 224, 71, 1);
            }
        }
        .team-card.is-leading {
            animation: leader-pulse 2.5s infinite ease-in-out;
            z-index: 20;
        }
        .leading-icon {
            position: absolute;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-shadow: 0px 4px 8px rgba(0, 0, 0, 0.5);
            filter: saturate(1.5);
        }
        .team-card.is-leading .leading-icon {
            opacity: 1;
            transform: scale(1) rotate(10deg);
        }
        .score-display {
            cursor: pointer;
        }
        .text-shadow-strong {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        #view-toggle-btn .expand-icon,
        #view-toggle-btn .compress-icon {
            display: none;
        }
        .view-classic #view-toggle-btn .expand-icon {
            display: block;
        }
        .view-fullscreen #view-toggle-btn .compress-icon {
            display: block;
        }
        .view-classic {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        .view-classic #classic-header,
        .view-classic #classic-footer {
            display: block;
        }
        .view-classic #fullscreen-footer {
            display: none;
        }
        .view-classic #teams-container {
            max-width: 90rem;
            width: 100%;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 2.5rem;
        }
        @media (min-width: 768px) {
            .view-classic #teams-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (min-width: 1024px) {
            .view-classic #teams-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        .view-classic .team-card {
            border-radius: 1.5rem;
            box-shadow: 0 15px 20px -5px rgb(0 0 0 / 0.1), 0 6px 8px -6px rgb(0 0 0 / 0.1);
            z-index: 10;
        }
        .view-classic .main-content-wrapper {
            padding: 3rem;
        }
        .view-classic .leading-icon {
            top: -30px;
            right: -20px;
            font-size: 72px;
        }
        .view-classic .title-container {
            height: 9rem;
        }
        .view-classic .title-70s,
        .view-classic .title-00s {
            font-size: 5.5rem;
            line-height: 0.9;
        }
        .view-classic .title-80s {
            font-size: 4.5rem;
            line-height: 1;
        }
        .view-classic .title-90s {
            font-size: 3.8rem;
            line-height: 1.2;
        }
        .view-classic .title-00s {
            font-size: 5.5rem;
            line-height: 0.9;
        }
        .view-classic .score-display {
            font-size: 12rem;
            line-height: 0.9;
            margin: 1.5rem 0;
        }
        .view-classic .subtitle {
            font-size: 1.25rem;
        }
        .view-classic .score-btn {
            height: 5rem;
            font-size: 2.25rem;
        }
        .view-classic .score-btn:first-child {
            border-bottom-left-radius: 1.5rem;
        }
        .view-classic .score-btn:last-child {
            border-bottom-right-radius: 1.5rem;
        }
        .view-fullscreen {
            overflow: hidden;
        }
        .view-fullscreen #classic-header,
        .view-fullscreen #classic-footer {
            display: none;
        }
        .view-fullscreen #fullscreen-footer {
            display: block;
        }
        .view-fullscreen #teams-container {
            height: 100vh;
            width: 100vw;
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            grid-template-rows: repeat(4, 1fr);
        }
        @media (min-width: 768px) {
            .view-fullscreen #teams-container {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(2, 1fr);
            }
        }
        .view-fullscreen .team-card {
            border-radius: 0;
            z-index: 10;
        }
        .view-fullscreen .main-content-wrapper {
            padding: 1rem;
        }
        .view-fullscreen .leading-icon {
            top: 1rem;
            right: 1.5rem;
            font-size: 6rem;
        }
        .view-fullscreen .title-70s,
        .view-fullscreen .title-00s {
            font-size: 6rem;
            line-height: 0.9;
        }
        .view-fullscreen .title-80s {
            font-size: 5rem;
            line-height: 1;
        }
        .view-fullscreen .title-90s {
            font-size: 4rem;
            line-height: 1.2;
        }
        .view-fullscreen .score-display {
            font-size: 20vh;
            line-height: 0.9;
        }
        .view-fullscreen .subtitle {
            font-size: 1.5rem;
        }
        .view-fullscreen .score-btn {
            height: 5rem;
            font-size: 2.25rem;
        }
        #balloons-container-back, #balloons-container-front {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        #balloons-container-back {
            z-index: 1;
        }
        #balloons-container-front {
            z-index: 25;
        }
        .view-fullscreen #balloons-container-back,
        .view-fullscreen #balloons-container-front {
            display: none;
        }
        .balloon {
            position: absolute;
            background-color: #ffcc00;
            border-radius: 70% 70% 80% 80% / 80% 80% 70% 70%;
            opacity: 0;
            transform: translateY(100vh);
            animation: ascend linear infinite;
            animation-fill-mode: backwards;
            filter: brightness(1.1);
            transform-origin: bottom center;
        }
        .balloon::after {
            content: '';
            position: absolute;
            width: 1px;
            height: 70px;
            background-color: rgba(0, 0, 0, 0.3);
            bottom: -70px;
            left: 50%;
            transform: translateX(-50%);
        }
        .balloon::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: inherit;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            border-radius: 50% 50% 0 50%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        @keyframes ascend {
            0% {
                transform: translateY(100vh) scale(0.6);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            80% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100%) scale(1.2);
                opacity: 0;
            }
        }
        .balloon-1 { background-color: #FDE047; width: 75px; height: 100px; animation-duration: 22s; animation-delay: 0s; z-index: 2; }
        .balloon-2 { background-color: #10B981; width: 88px; height: 118px; animation-duration: 25s; animation-delay: 1.5s; z-index: 3; }
        .balloon-3 { background-color: #3B82F6; width: 70px; height: 95px; animation-duration: 19s; animation-delay: 3s; z-index: 2; }
        .balloon-4 { background-color: #35393D; width: 82px; height: 110px; animation-duration: 26s; animation-delay: 4.5s; z-index: 3; }
        .balloon-5 { background-color: #f7931e; width: 94px; height: 125px; animation-duration: 24s; animation-delay: 6s; z-index: 2; }
        .balloon-6 { background-color: #ef4444; width: 62px; height: 82px; animation-duration: 18s; animation-delay: 7.5s; z-index: 3; }
        .balloon-7 { background-color: #8B5CF6; width: 100px; height: 135px; animation-duration: 28s; animation-delay: 9s; z-index: 2; }
        .balloon-8 { background-color: #6EE7B7; width: 75px; height: 105px; animation-duration: 23s; animation-delay: 10.5s; z-index: 3; }
        .balloon-9 { background-color: #F87171; width: 88px; height: 118px; animation-duration: 25s; animation-delay: 12s; z-index: 2; }
        .balloon-10 { background-color: #FACC15; width: 75px; height: 100px; animation-duration: 21s; animation-delay: 13.5s; z-index: 3; }
        .balloon-11 { background-color: #A78BFA; width: 80px; height: 105px; animation-duration: 27s; animation-delay: 1s; z-index: 2; }
        .balloon-12 { background-color: #22D3EE; width: 70px; height: 95px; animation-duration: 20s; animation-delay: 4s; z-index: 3; }
        .balloon-13 { background-color: #FB923C; width: 90px; height: 120px; animation-duration: 24s; animation-delay: 8s; z-index: 2; }
        .balloon-14 { background-color: #F472B6; width: 78px; height: 100px; animation-duration: 22s; animation-delay: 11s; z-index: 3; }
        .balloon-15 { background-color: #4ADE80; width: 65px; height: 85px; animation-duration: 18s; animation-delay: 14s; z-index: 2; }
    </style>
</head>
<body class="text-gray-800">
    <div id="balloons-container-back">
        <div class="balloon balloon-1"></div>
        <div class="balloon balloon-2"></div>
        <div class="balloon balloon-4"></div>
        <div class="balloon balloon-5"></div>
        <div class="balloon balloon-6"></div>
        <div class="balloon balloon-8"></div>
        <div class="balloon balloon-9"></div>
        <div class="balloon balloon-10"></div>
        <div class="balloon balloon-11"></div>
    </div>
    <div id="balloons-container-front">
        <div class="balloon balloon-3"></div>
        <div class="balloon balloon-7"></div>
        <div class="balloon balloon-12"></div>
        <div class="balloon balloon-13"></div>
        <div class="balloon balloon-14"></div>
        <div class="balloon balloon-15"></div>
    </div>
    <button id="view-toggle-btn" class="fixed top-4 right-4 z-50 p-2 bg-black bg-opacity-20 rounded-full text-white hover:bg-opacity-30 transition-colors">
        <svg class="w-6 h-6 expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 1v4m0 0h-4m4 0l-5-5"></path></svg>
        <svg class="w-6 h-6 compress-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9V4.5M15 9h4.5M15 9l5.25-5.25M15 15v4.5M15 15h4.5M15 15l5.25 5.25" /></svg>
    </button>
    <div id="classic-header">
        <header class="text-center my-8">
            <h1 class="text-4xl md:text-5xl font-black tracking-tight text-orange-500"></h1><br>
            <p class="text-gray-600 mt-2 text-lg text-2xl"></p>
        </header>
    </div>
    <main id="teams-container"></main>
    <div id="classic-footer">
        <footer class="my-12 text-center">
            <button id="declare-winner-btn-classic" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-6 text-base rounded-full shadow-lg transform transition-transform duration-200 hover:scale-105">
                Declarar Ganador
            </button>
        </footer>
    </div>
    <div id="fullscreen-footer">
        <footer class="fixed bottom-10 left-1/2 -translate-x-1/2 z-50">
            <button id="declare-winner-btn-fullscreen" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-6 text-base rounded-full shadow-lg transform transition-transform duration-200 hover:scale-105">
                Declarar Ganador
            </button>
        </footer>
    </div>
    <div id="winner-modal" class="hidden fixed inset-0 z-50">
        <div id="winner-card" class="w-full h-full flex flex-col items-center justify-center p-8 text-center transition-colors duration-500 relative overflow-hidden">
            <h2 class="text-4xl font-bold mb-4">¡La alianza ganadora es!</h2>
            <p id="winner-name" class="text-8xl font-black mb-6"></p>
            <p id="winner-score" class="text-3xl"></p>
            <button id="close-modal-btn" class="absolute bottom-8 md:bottom-12 font-bold py-3 px-8 rounded-full transition-colors z-20">
                Cerrar
            </button>
        </div>
        <canvas id="confetti-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none"></canvas>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const teamsContainer = document.getElementById('teams-container');
            const winnerModal = document.getElementById('winner-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const confettiCanvas = document.getElementById('confetti-canvas');
            const viewToggleBtn = document.getElementById('view-toggle-btn');
            const confettiInstance = confetti.create(confettiCanvas, {
                resize: true,
                useWorker: true
            });
            let confettiInterval = null,
                rainInterval = null;
            const initialTeams = [{
                id: '70s',
                name: "70's",
                subtitle: 'Alianza Amarilla',
                score: 0,
                bgColor: 'bg-yellow-400',
                textColor: 'text-white',
                titleClass: 'title-70s'
            }, {
                id: '80s',
                name: "80's",
                subtitle: 'Alianza Verde',
                score: 0,
                bgColor: 'bg-green-500',
                textColor: 'text-white',
                titleClass: 'title-80s'
            }, {
                id: '90s',
                name: "90's",
                subtitle: 'Alianza Azul',
                score: 0,
                bgColor: 'bg-blue-500',
                textColor: 'text-white',
                titleClass: 'title-90s'
            }, {
                id: '00s',
                name: "00's",
                subtitle: 'Alianza Negra',
                score: 0,
                bgColor: 'bg-[#35393D]',
                textColor: 'text-white',
                titleClass: 'title-00s'
            }];
            let teams = [];
            let currentView = 'classic';

            function loadState() {
                const savedState = localStorage.getItem('scoreboardState');
                teams = savedState ? JSON.parse(savedState) : initialTeams.map(t => ({ ...t
                }));
                currentView = localStorage.getItem('scoreboardView') || 'classic';
                body.classList.add(`view-${currentView}`);
            }

            function saveState() {
                localStorage.setItem('scoreboardState', JSON.stringify(teams));
            }

            function toggleView() {
                body.classList.remove(`view-${currentView}`);
                currentView = currentView === 'classic' ? 'fullscreen' : 'classic';
                body.classList.add(`view-${currentView}`);
                localStorage.setItem('scoreboardView', currentView);
            }

            function renderTeams() {
                teamsContainer.innerHTML = '';
                teams.forEach(team => {
                    const teamCard = `
                        <div id="card-${team.id}" class="team-card ${team.bgColor} flex flex-col justify-between transition-transform duration-300 relative">
                           <div class="main-content-wrapper flex flex-col items-center justify-around flex-grow">
                                <div class="leading-icon"></div>
                                <div class="text-center z-10 title-container">
                                    <h2 class="${team.titleClass}">${team.name}</h2>
                                    <p class="subtitle font-semibold ${team.textColor} opacity-80 mt-2 text-shadow-strong">${team.subtitle}</p>
                                </div>
                                <div class="score-display font-black ${team.textColor} z-10" id="score-${team.id}" data-team-id="${team.id}">${team.score}</div>
                           </div>
                            <div class="flex w-full z-10">
                                <button data-team-id="${team.id}" data-action="subtract" class="score-btn w-1/2 font-bold bg-white bg-opacity-20 hover:bg-opacity-30 ${team.textColor} flex items-center justify-center transition-colors border-r border-white/10">-</button>
                                <button data-team-id="${team.id}" data-action="add" class="score-btn w-1/2 font-bold bg-white bg-opacity-20 hover:bg-opacity-30 ${team.textColor} flex items-center justify-center transition-colors">+</button>
                            </div>
                        </div>
                    `;
                    teamsContainer.insertAdjacentHTML('beforeend', teamCard);
                });
            }

            function updateScoreDisplay(teamId, newScore) {
                const scoreElement = document.getElementById(`score-${teamId}`);
                if (scoreElement) {
                    scoreElement.textContent = newScore;
                    scoreElement.classList.add('score-change');
                    setTimeout(() => scoreElement.classList.remove('score-change'), 200);
                }
            }

            function updateLeaderHighlight() {
                if (teams.length === 0) return;
                const scores = teams.map(t => t.score);
                const maxScore = Math.max(...scores);
                const leaders = teams.filter(t => t.score === maxScore && maxScore > 0);
                const icon = leaders.length > 1 ? '⚔️' : '🏆';
                teams.forEach(team => {
                    const cardElement = document.getElementById(`card-${team.id}`);
                    if (!cardElement) return;
                    const iconElement = cardElement.querySelector('.leading-icon');
                    const isLeader = leaders.some(leader => leader.id === team.id);
                    cardElement.classList.toggle('is-leading', isLeader);
                    if (isLeader) iconElement.textContent = icon;
                });
            }

            function handleScoreChange(event) {
                const button = event.target.closest('.score-btn');
                if (!button) return;
                const teamId = button.dataset.teamId;
                const action = button.dataset.action;
                const team = teams.find(t => t.id === teamId);
                if (team) {
                    team.score += (action === 'add' ? 1 : -1);
                    if (team.score < 0) team.score = 0;
                    updateScoreDisplay(teamId, team.score);
                    saveState();
                    updateLeaderHighlight();
                }
            }

            function handleManualScoreEdit(event) {
                const scoreElement = event.target.closest('.score-display');
                if (!scoreElement) return;
                const teamId = scoreElement.dataset.teamId;
                const team = teams.find(t => t.id === teamId);
                if (!team) return;
                const newScoreRaw = prompt(`Ingresa el nuevo puntaje para ${team.subtitle}:`, team.score);
                if (newScoreRaw !== null) {
                    const newScore = parseInt(newScoreRaw, 10);
                    if (!isNaN(newScore) && newScore >= 0) {
                        team.score = newScore;
                        updateScoreDisplay(teamId, newScore);
                        saveState();
                        updateLeaderHighlight();
                    } else {
                        alert('Por favor, ingresa un número válido y positivo.');
                    }
                }
            }

            function showWinner() {
                if (teams.length === 0) return;
                const maxScore = Math.max(...teams.map(t => t.score));
                const winners = teams.filter(t => t.score === maxScore);
                if (winners.length > 0) {
                    const winnerCard = document.getElementById('winner-card');
                    const winnerNameEl = document.getElementById('winner-name');
                    const winnerScoreEl = document.getElementById('winner-score');
                    winnerNameEl.innerHTML = winners.map(w => w.subtitle).join(' & ');
                    winnerScoreEl.textContent = `Con un puntaje final de ${maxScore} pts`;
                    let bgColor = winners.length === 1 ? winners[0].bgColor : 'bg-gray-800';
                    let textColor = 'text-white';
                    winnerCard.className = `w-full h-full flex flex-col items-center justify-center p-8 text-center transition-colors duration-500 relative overflow-hidden ${bgColor}`;
                    closeModalBtn.className = `absolute bottom-8 md:bottom-12 font-bold py-3 px-8 rounded-full transition-colors bg-black bg-opacity-20 hover:bg-opacity-30 ${textColor} z-20`;
                    winnerCard.querySelector('h2').className = `text-4xl font-bold mb-4 ${textColor} text-shadow-strong`;
                    winnerNameEl.className = `text-8xl font-black mb-6 ${textColor} text-shadow-strong`;
                    winnerScoreEl.className = `text-3xl ${textColor} text-shadow-strong`;
                    winnerModal.classList.remove('hidden');
                    launchContinuousConfetti();
                }
            }

            function hideWinner() {
                winnerModal.classList.add('hidden');
                if (confettiInterval) clearInterval(confettiInterval);
                if (rainInterval) clearInterval(rainInterval);
                confettiInstance.reset();
            }

            function launchContinuousConfetti() {
                if (confettiInterval) clearInterval(confettiInterval);
                if (rainInterval) clearInterval(rainInterval);
                const firework = () => confettiInstance({
                    particleCount: 150,
                    startVelocity: 35,
                    spread: 120,
                    angle: 90,
                    origin: {
                        x: Math.random(),
                        y: 1.1
                    },
                    gravity: 0.8
                });
                const softRain = () => confettiInstance({
                    particleCount: 3,
                    angle: 270,
                    spread: 100,
                    origin: {
                        x: Math.random(),
                        y: -0.2
                    },
                    gravity: 0.1,
                    ticks: 600,
                    scalar: 0.8
                });
                firework();
                confettiInterval = setInterval(firework, 900);
                rainInterval = setInterval(softRain, 100);
            }

            function randomizeBalloons() {
                const balloons = document.querySelectorAll('.balloon');
                
                function setRandomPosition(balloon) {
                    const randomLeft = Math.random() * 95;
                    balloon.style.left = `${randomLeft}%`;
                }

                balloons.forEach(balloon => {
                    setRandomPosition(balloon);
                    balloon.addEventListener('animationiteration', () => {
                        setRandomPosition(balloon);
                    });
                });
            }

            function init() {
                loadState();
                renderTeams();
                updateLeaderHighlight();
                randomizeBalloons();
                teamsContainer.addEventListener('click', handleScoreChange);
                teamsContainer.addEventListener('click', handleManualScoreEdit);
                document.getElementById('declare-winner-btn-classic').addEventListener('click', showWinner);
                document.getElementById('declare-winner-btn-fullscreen').addEventListener('click', showWinner);
                closeModalBtn.addEventListener('click', hideWinner);
                viewToggleBtn.addEventListener('click', toggleView);
            }
            init();
        });
    </script>
</body>
</html>
